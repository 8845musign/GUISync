/// <reference path="../../typings/github-electron/github-electron-renderer.d.ts" />;
/// <reference path="../../typings/bluebird/bluebird.d.ts" />;
// Services
var BrowserSyncService = require('./lib/modules/services/BrowserSyncService');
var SettingModel = require('./lib/modules/models/SettingModel');
var ConsoleService = require('./lib/modules/services/consoleService');
var SettingFileService = require('./lib/modules/services/SettingFileService');
// UI
var Dialog = require('./lib/modules/ui/dialog/dialog');
//View
var BtnActionView = require('./lib/modules/views/BtnActionView');
var UrlDisplayView = require('./lib/modules/views/UrlDisplayView');
var App = (function () {
    function App() {
        this.browserSync = new BrowserSyncService();
    }
    App.prototype.start = function () {
        this.urlDisplayView = new UrlDisplayView('.dispUrl__text');
        var btnActionView = new BtnActionView({
            selector: '#btnRun',
            startFunc: function (event) {
                if (this.browserSync.isRunning())
                    return;
                this.createSettingFile();
                var start = this.browserSync.start();
                start.on('start', function (data) {
                    this.console.log(data);
                    var url = this.browserSync.getUrlFromStdout(data);
                    this.urlDisplayView.setUrl(url);
                    this.console.log(data);
                    event.emit('started');
                });
                start.on('error', function (data) {
                    this.console.log(data);
                    this.urlDisplayView.clearUrl();
                    this.console.log(data);
                    event.emit('started');
                });
            }.bind(this),
            stopFunc: function (event) {
                this.browserSync.stop();
                this.urlDisplayView.clearUrl();
                event.emit('stoped');
            }.bind(this),
        });
        this.console = new ConsoleService('#windowConsole');
        this.checkBrowserSync();
    };
    App.prototype.checkBrowserSync = function () {
        BrowserSyncService.isInstelled().then(function () {
            // nothing
        }).catch(function () {
            Dialog.normal({
                text: "BrowserSyncをインストールします",
                buttonText: "OK",
                callback: function () {
                    var install = BrowserSyncService.install();
                    install.on('install', function () {
                        Dialog.normal({ text: 'インストール完了しました', buttonText: 'OK' });
                    });
                }
            });
        });
    };
    App.prototype.onClickStopBtn = function (e) {
        if (this.browserSync.isRunning() === false)
            return;
        this.browserSync.stop();
        this.btnStart.disabled = false;
        e.preventDefault();
    };
    App.prototype.createSettingFile = function () {
        var user = document.getElementById('authUser').value;
        var pass = document.getElementById('authPass').value;
        var proxyTarget = document.getElementById('proxyTarget').value;
        var setting = new SettingModel({
            target: proxyTarget,
            basicId: user,
            basicPassword: pass
        });
        SettingFileService.create(setting);
    };
    return App;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFwcC50cyJdLCJuYW1lcyI6WyJBcHAiLCJBcHAuY29uc3RydWN0b3IiLCJBcHAuc3RhcnQiLCJBcHAuY2hlY2tCcm93c2VyU3luYyIsIkFwcC5vbkNsaWNrU3RvcEJ0biIsIkFwcC5jcmVhdGVTZXR0aW5nRmlsZSJdLCJtYXBwaW5ncyI6IkFBQUEscUZBQXFGO0FBQ3JGLDhEQUE4RDtBQUU5RCxXQUFXO0FBQ1gsSUFBTyxrQkFBa0IsV0FBVywyQ0FBMkMsQ0FBQyxDQUFDO0FBQ2pGLElBQU8sWUFBWSxXQUFpQixtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3pFLElBQU8sY0FBYyxXQUFlLHVDQUF1QyxDQUFDLENBQUM7QUFDN0UsSUFBTyxrQkFBa0IsV0FBVywyQ0FBMkMsQ0FBQyxDQUFDO0FBQ2pGLEtBQUs7QUFDTCxJQUFPLE1BQU0sV0FBdUIsZ0NBQWdDLENBQUMsQ0FBQztBQUd0RSxNQUFNO0FBQ04sSUFBTyxhQUFhLFdBQVksbUNBQW1DLENBQUMsQ0FBQztBQUNyRSxJQUFPLGNBQWMsV0FBVyxvQ0FBb0MsQ0FBQyxDQUFDO0FBRXRFO0lBUUVBO1FBQ0VDLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLGtCQUFrQkEsRUFBRUEsQ0FBQ0E7SUFDOUNBLENBQUNBO0lBRU1ELG1CQUFLQSxHQUFaQTtRQUNFRSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxjQUFjQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO1FBQzNEQSxJQUFJQSxhQUFhQSxHQUFHQSxJQUFJQSxhQUFhQSxDQUFDQTtZQUNwQ0EsUUFBUUEsRUFBQ0EsU0FBU0E7WUFDbEJBLFNBQVNBLEVBQUVBLFVBQVNBLEtBQUtBO2dCQUN2QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxDQUFDO29CQUFDLE1BQU0sQ0FBQztnQkFDekMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBRXpCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENB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RUEsQ0FBQ0EsS0FBS0EsQ0FBQUE7UUFDakZBLElBQUlBLElBQUlBLEdBQStCQSxRQUFRQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFFQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUNsRkEsSUFBSUEsV0FBV0EsR0FBK0JBLFFBQVFBLENBQUNBLGNBQWNBLENBQUNBLGFBQWFBLENBQUVBLENBQUNBLEtBQUtBLENBQUNBO1FBRTVGQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQTtZQUM3QkEsTUFBTUEsRUFBRUEsV0FBV0E7WUFDbkJBLE9BQU9BLEVBQUNBLElBQUlBO1lBQ1pBLGFBQWFBLEVBQUVBLElBQUlBO1NBQ3BCQSxDQUFDQSxDQUFDQTtRQUVIQSxrQkFBa0JBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBQ3JDQSxDQUFDQTtJQUNITCxVQUFDQTtBQUFEQSxDQXpGQSxBQXlGQ0EsSUFBQSIsImZpbGUiOiJBcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9naXRodWItZWxlY3Ryb24vZ2l0aHViLWVsZWN0cm9uLXJlbmRlcmVyLmQudHNcIiAvPjtcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2JsdWViaXJkL2JsdWViaXJkLmQudHNcIiAvPjtcblxuLy8gU2VydmljZXNcbmltcG9ydCBCcm93c2VyU3luY1NlcnZpY2UgPSByZXF1aXJlKCcuL2xpYi9tb2R1bGVzL3NlcnZpY2VzL0Jyb3dzZXJTeW5jU2VydmljZScpO1xuaW1wb3J0IFNldHRpbmdNb2RlbCAgICAgICA9IHJlcXVpcmUoJy4vbGliL21vZHVsZXMvbW9kZWxzL1NldHRpbmdNb2RlbCcpO1xuaW1wb3J0IENvbnNvbGVTZXJ2aWNlICAgICA9IHJlcXVpcmUoJy4vbGliL21vZHVsZXMvc2VydmljZXMvY29uc29sZVNlcnZpY2UnKTtcbmltcG9ydCBTZXR0aW5nRmlsZVNlcnZpY2UgPSByZXF1aXJlKCcuL2xpYi9tb2R1bGVzL3NlcnZpY2VzL1NldHRpbmdGaWxlU2VydmljZScpO1xuLy8gVUlcbmltcG9ydCBEaWFsb2cgICAgICAgICAgICAgPSByZXF1aXJlKCcuL2xpYi9tb2R1bGVzL3VpL2RpYWxvZy9kaWFsb2cnKTtcbmltcG9ydCBMb2FkaW5nICAgICAgICAgICAgPSByZXF1aXJlKCcuL2xpYi9tb2R1bGVzL3VpL2xvYWRpbmcvTG9hZGluZycpO1xuXG4vL1ZpZXdcbmltcG9ydCBCdG5BY3Rpb25WaWV3ICA9IHJlcXVpcmUoJy4vbGliL21vZHVsZXMvdmlld3MvQnRuQWN0aW9uVmlldycpO1xuaW1wb3J0IFVybERpc3BsYXlWaWV3ID0gcmVxdWlyZSgnLi9saWIvbW9kdWxlcy92aWV3cy9VcmxEaXNwbGF5VmlldycpO1xuXG5jbGFzcyBBcHAge1xuICBwcml2YXRlIGJ0blN0YXJ0OkhUTUxCdXR0b25FbGVtZW50O1xuICBwcml2YXRlIGJ0bkluc3RhbGw6SFRNTEJ1dHRvbkVsZW1lbnQ7XG4gIHByaXZhdGUgYnRuU3RvcDpIVE1MQnV0dG9uRWxlbWVudDtcbiAgcHJpdmF0ZSBjb25zb2xlOkNvbnNvbGVTZXJ2aWNlO1xuICBwcml2YXRlIGJyb3dzZXJTeW5jOkJyb3dzZXJTeW5jU2VydmljZTtcbiAgcHJpdmF0ZSB1cmxEaXNwbGF5VmlldzpVcmxEaXNwbGF5VmlldztcbiAgXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYnJvd3NlclN5bmMgPSBuZXcgQnJvd3NlclN5bmNTZXJ2aWNlKCk7XG4gIH1cblxuICBwdWJsaWMgc3RhcnQoKSA6IHZvaWQge1xuICAgIHRoaXMudXJsRGlzcGxheVZpZXcgPSBuZXcgVXJsRGlzcGxheVZpZXcoJy5kaXNwVXJsX190ZXh0Jyk7XG4gICAgdmFyIGJ0bkFjdGlvblZpZXcgPSBuZXcgQnRuQWN0aW9uVmlldyh7XG4gICAgICBzZWxlY3RvcjonI2J0blJ1bicsXG4gICAgICBzdGFydEZ1bmM6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmJyb3dzZXJTeW5jLmlzUnVubmluZygpKSByZXR1cm47XG4gICAgICAgIHRoaXMuY3JlYXRlU2V0dGluZ0ZpbGUoKTtcbiAgXG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuYnJvd3NlclN5bmMuc3RhcnQoKTtcblxuICAgICAgICBzdGFydC5vbignc3RhcnQnLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICB0aGlzLmNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgIHZhciB1cmwgPSB0aGlzLmJyb3dzZXJTeW5jLmdldFVybEZyb21TdGRvdXQoZGF0YSk7XG4gICAgICAgICAgdGhpcy51cmxEaXNwbGF5Vmlldy5zZXRVcmwodXJsKTtcbiAgICAgICAgICB0aGlzLmNvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgICAgZXZlbnQuZW1pdCgnc3RhcnRlZCcpO1xuICAgICAgICB9KTtcbiAgXG4gICAgICAgIHN0YXJ0Lm9uKCdlcnJvcicsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgIHRoaXMuY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgdGhpcy51cmxEaXNwbGF5Vmlldy5jbGVhclVybCgpO1xuICAgICAgICAgIHRoaXMuY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICBldmVudC5lbWl0KCdzdGFydGVkJyk7XG4gICAgICAgIH0pO1xuICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgc3RvcEZ1bmM6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgdGhpcy5icm93c2VyU3luYy5zdG9wKCk7XG4gICAgICAgIHRoaXMudXJsRGlzcGxheVZpZXcuY2xlYXJVcmwoKTtcblxuICAgICAgICBldmVudC5lbWl0KCdzdG9wZWQnKTtcbiAgICAgIH0uYmluZCh0aGlzKSxcbiAgICB9KTtcbiAgICB0aGlzLmNvbnNvbGUgICAgPSBuZXcgQ29uc29sZVNlcnZpY2UoJyN3aW5kb3dDb25zb2xlJyk7XG5cbiAgICB0aGlzLmNoZWNrQnJvd3NlclN5bmMoKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGVja0Jyb3dzZXJTeW5jKCkge1xuICAgIEJyb3dzZXJTeW5jU2VydmljZS5pc0luc3RlbGxlZCgpLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgIC8vIG5vdGhpbmdcbiAgICB9KS5jYXRjaChmdW5jdGlvbigpe1xuICAgICAgRGlhbG9nLm5vcm1hbCh7XG4gICAgICAgIHRleHQ6IFwiQnJvd3NlclN5bmPjgpLjgqTjg7Pjgrnjg4jjg7zjg6vjgZfjgb7jgZlcIixcbiAgICAgICAgYnV0dG9uVGV4dDogXCJPS1wiLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGluc3RhbGwgPSBCcm93c2VyU3luY1NlcnZpY2UuaW5zdGFsbCgpO1xuICAgICAgICAgIGluc3RhbGwub24oJ2luc3RhbGwnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgRGlhbG9nLm5vcm1hbCh7IHRleHQ6J+OCpOODs+OCueODiOODvOODq+WujOS6huOBl+OBvuOBl+OBnycsIGJ1dHRvblRleHQ6J09LJyB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgICBcbiAgcHJpdmF0ZSBvbkNsaWNrU3RvcEJ0bihlOkV2ZW50KSA6IHZvaWQge1xuICAgIGlmICh0aGlzLmJyb3dzZXJTeW5jLmlzUnVubmluZygpID09PSBmYWxzZSkgcmV0dXJuO1xuICAgIHRoaXMuYnJvd3NlclN5bmMuc3RvcCgpO1xuICAgIHRoaXMuYnRuU3RhcnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlU2V0dGluZ0ZpbGUoKSA6IHZvaWQge1xuICAgIHZhciB1c2VyIDogc3RyaW5nID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRoVXNlcicpKS52YWx1ZVxuICAgIHZhciBwYXNzIDogc3RyaW5nID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRoUGFzcycpKS52YWx1ZTtcbiAgICB2YXIgcHJveHlUYXJnZXQgOiBzdHJpbmcgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3h5VGFyZ2V0JykpLnZhbHVlO1xuXG4gICAgdmFyIHNldHRpbmcgPSBuZXcgU2V0dGluZ01vZGVsKHtcbiAgICAgIHRhcmdldDogcHJveHlUYXJnZXQsIFxuICAgICAgYmFzaWNJZDp1c2VyLCBcbiAgICAgIGJhc2ljUGFzc3dvcmQ6IHBhc3NcbiAgICB9KTtcblxuICAgIFNldHRpbmdGaWxlU2VydmljZS5jcmVhdGUoc2V0dGluZyk7XG4gIH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=